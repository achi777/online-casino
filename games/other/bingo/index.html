<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>90-Ball Bingo - Casino Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #2E1A47 0%, #6A1B9A 50%, #2E1A47 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }

        .game-container {
            background: linear-gradient(145deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.7);
            max-width: 1400px;
            width: 100%;
            border: 4px solid #9C27B0;
        }

        .game-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .game-header h1 {
            color: #9C27B0;
            font-size: 3.5em;
            text-shadow: 0 0 30px rgba(156, 39, 176, 1), 0 4px 8px rgba(0, 0, 0, 0.7);
            margin-bottom: 8px;
            animation: glow 2s ease-in-out infinite;
        }

        @keyframes glow {
            0%, 100% { text-shadow: 0 0 30px rgba(156, 39, 176, 0.8), 0 4px 8px rgba(0, 0, 0, 0.7); }
            50% { text-shadow: 0 0 50px rgba(156, 39, 176, 1), 0 4px 8px rgba(0, 0, 0, 0.7); }
        }

        .game-header .subtitle {
            color: #fff;
            font-size: 1.3em;
            opacity: 0.9;
        }

        .game-info {
            display: flex;
            justify-content: space-around;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 12px;
        }

        .info-box {
            background: rgba(156, 39, 176, 0.2);
            padding: 12px 25px;
            border-radius: 12px;
            border: 2px solid #9C27B0;
            min-width: 150px;
        }

        .info-box label {
            color: #9C27B0;
            font-size: 0.95em;
            display: block;
            margin-bottom: 5px;
        }

        .info-box span {
            color: #fff;
            font-size: 1.5em;
            font-weight: bold;
        }

        .main-area {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 20px;
            margin-bottom: 25px;
        }

        .cards-area {
            background: linear-gradient(145deg, #0f3460 0%, #16213e 100%);
            border-radius: 20px;
            padding: 25px;
            border: 3px solid #9C27B0;
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .bingo-card {
            background: linear-gradient(145deg, #fff 0%, #f0f0f0 100%);
            border-radius: 12px;
            padding: 12px;
            border: 3px solid #9C27B0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .card-header {
            background: linear-gradient(145deg, #9C27B0 0%, #7B1FA2 100%);
            color: #fff;
            padding: 8px;
            border-radius: 8px 8px 0 0;
            text-align: center;
            font-weight: bold;
            font-size: 1.1em;
            margin: -12px -12px 10px -12px;
        }

        .card-grid {
            display: grid;
            grid-template-columns: repeat(9, 1fr);
            gap: 3px;
        }

        .card-cell {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #fff;
            border: 2px solid #9C27B0;
            border-radius: 6px;
            font-weight: bold;
            font-size: 0.95em;
            cursor: pointer;
            transition: all 0.3s;
        }

        .card-cell.empty {
            background: #e0e0e0;
            border-color: #ccc;
        }

        .card-cell.daubed {
            background: linear-gradient(145deg, #9C27B0 0%, #7B1FA2 100%);
            color: #fff;
            transform: scale(0.95);
        }

        .card-cell:not(.empty):not(.daubed):hover {
            background: #f0e5ff;
            transform: scale(1.05);
        }

        .caller-area {
            background: linear-gradient(145deg, #0f3460 0%, #16213e 100%);
            border-radius: 20px;
            padding: 25px;
            border: 3px solid #9C27B0;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .current-ball {
            background: radial-gradient(circle, #9C27B0 0%, #7B1FA2 100%);
            width: 150px;
            height: 150px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            border: 8px solid #fff;
            box-shadow: 0 0 30px rgba(156, 39, 176, 0.8);
            animation: ballPulse 2s ease-in-out infinite;
        }

        @keyframes ballPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .ball-number {
            color: #fff;
            font-size: 4em;
            font-weight: bold;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
        }

        .ball-text {
            text-align: center;
            color: #9C27B0;
            font-size: 1.2em;
            font-weight: bold;
            margin-top: 10px;
        }

        .called-numbers {
            background: rgba(156, 39, 176, 0.1);
            border-radius: 12px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
        }

        .called-numbers h3 {
            color: #9C27B0;
            margin-bottom: 12px;
            text-align: center;
        }

        .numbers-grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 5px;
        }

        .number-ball {
            aspect-ratio: 1;
            background: #333;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85em;
            color: #888;
            font-weight: bold;
            border: 2px solid #444;
        }

        .number-ball.called {
            background: linear-gradient(145deg, #9C27B0 0%, #7B1FA2 100%);
            color: #fff;
            border-color: #fff;
            animation: numberPop 0.5s ease-out;
        }

        @keyframes numberPop {
            0% { transform: scale(0); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .bet-controls {
            display: flex;
            justify-content: center;
            gap: 12px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .chip {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
            border: 3px solid #fff;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
            font-size: 0.95em;
        }

        .chip:hover {
            transform: scale(1.2);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.6);
        }

        .chip.selected {
            border-color: #9C27B0;
            box-shadow: 0 0 25px rgba(156, 39, 176, 1);
        }

        .chip-1 { background: radial-gradient(circle, #fff 0%, #e0e0e0 100%); color: #000; }
        .chip-5 { background: radial-gradient(circle, #ff4444 0%, #cc0000 100%); color: #fff; }
        .chip-10 { background: radial-gradient(circle, #4444ff 0%, #0000cc 100%); color: #fff; }
        .chip-25 { background: radial-gradient(circle, #44ff44 0%, #00cc00 100%); color: #000; }
        .chip-100 { background: radial-gradient(circle, #000 0%, #333 100%); color: #fff; }

        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 16px 40px;
            font-size: 1.15em;
            font-weight: bold;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.4);
        }

        .btn-start {
            background: linear-gradient(145deg, #9C27B0 0%, #7B1FA2 100%);
            color: #fff;
        }

        .btn-start:hover:not(:disabled) {
            background: linear-gradient(145deg, #7B1FA2 0%, #9C27B0 100%);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5);
        }

        .btn-autodaub {
            background: linear-gradient(145deg, #2196F3 0%, #1976D2 100%);
            color: #fff;
        }

        .btn-autodaub.active {
            background: linear-gradient(145deg, #4CAF50 0%, #388E3C 100%);
        }

        .btn-autodaub:hover {
            transform: translateY(-3px);
        }

        .btn-clear {
            background: linear-gradient(145deg, #e74c3c 0%, #c0392b 100%);
            color: #fff;
        }

        .btn-clear:hover {
            background: linear-gradient(145deg, #c0392b 0%, #e74c3c 100%);
            transform: translateY(-3px);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .result-message {
            text-align: center;
            margin-top: 20px;
            min-height: 50px;
            font-size: 1.5em;
            font-weight: bold;
        }

        .result-message.win {
            color: #4CAF50;
            animation: fadeIn 0.6s;
        }

        .result-message.lose {
            color: #e74c3c;
            animation: fadeIn 0.6s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .win-indicator {
            background: linear-gradient(145deg, #4CAF50 0%, #388E3C 100%);
            color: #fff;
            padding: 8px 16px;
            border-radius: 8px;
            margin-top: 10px;
            text-align: center;
            font-weight: bold;
            animation: winPulse 1s ease-in-out infinite;
        }

        @keyframes winPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @media (max-width: 1200px) {
            .main-area {
                grid-template-columns: 1fr;
            }

            .cards-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 768px) {
            .game-header h1 {
                font-size: 2.5em;
            }

            .cards-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .chip {
                width: 50px;
                height: 50px;
                font-size: 0.85em;
            }
        }

        @media (max-width: 480px) {
            .cards-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-header">
            <h1>üé± 90-BALL BINGO üé±</h1>
            <div class="subtitle">Eyes Down for a Full House!</div>
        </div>

        <div class="game-info">
            <div class="info-box">
                <label>Balance</label>
                <span id="balance">1000.00</span>
            </div>
            <div class="info-box">
                <label>Card Price</label>
                <span id="card-price">10</span>
            </div>
            <div class="info-box">
                <label>Balls Called</label>
                <span id="balls-called">0</span>
            </div>
        </div>

        <div class="main-area">
            <div class="cards-area">
                <div class="cards-grid" id="cards-grid"></div>
            </div>

            <div class="caller-area">
                <div>
                    <div class="current-ball" id="current-ball">
                        <div class="ball-number" id="ball-number">--</div>
                    </div>
                    <div class="ball-text" id="ball-text">Waiting to start...</div>
                </div>

                <div class="called-numbers">
                    <h3>Called Numbers</h3>
                    <div class="numbers-grid" id="numbers-grid"></div>
                </div>
            </div>
        </div>

        <div class="controls">
            <div class="bet-controls">
                <div class="chip chip-1" data-value="1">$1</div>
                <div class="chip chip-5" data-value="5">$5</div>
                <div class="chip chip-10 selected" data-value="10">$10</div>
                <div class="chip chip-25" data-value="25">$25</div>
                <div class="chip chip-100" data-value="100">$100</div>
            </div>

            <div class="action-buttons">
                <button class="btn btn-start" id="start-btn">Buy Cards & Play</button>
                <button class="btn btn-autodaub active" id="autodaub-btn">Auto-Daub: ON</button>
                <button class="btn btn-clear" id="new-cards-btn">New Cards</button>
            </div>
        </div>

        <div class="result-message" id="result-message"></div>
    </div>

    <script>
        // Get URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        let sessionToken = urlParams.get('session') || '';
        let isDemo = urlParams.get('demo') === 'true';
        const jwtToken = urlParams.get('token') || '';

        let balance = 1000;
        let cardPrice = 10;
        let autoDaub = true;
        let isPlaying = false;
        let gameId = null;
        let roundId = 1;

        const balanceEl = document.getElementById('balance');
        const cardPriceEl = document.getElementById('card-price');
        const ballsCalledEl = document.getElementById('balls-called');
        const currentBallEl = document.getElementById('current-ball');
        const ballNumberEl = document.getElementById('ball-number');
        const ballTextEl = document.getElementById('ball-text');
        const numbersGridEl = document.getElementById('numbers-grid');
        const cardsGridEl = document.getElementById('cards-grid');
        const startBtn = document.getElementById('start-btn');
        const autodaubBtn = document.getElementById('autodaub-btn');
        const newCardsBtn = document.getElementById('new-cards-btn');
        const resultMessageEl = document.getElementById('result-message');

        let cards = [];
        let calledNumbers = [];
        let gameInterval = null;
        let remainingNumbers = [];

        // Bingo prizes
        const prizes = {
            '1line': 50,
            '2lines': 150,
            'fullhouse': 500
        };

        let winsClaimed = {
            '1line': false,
            '2lines': false,
            'fullhouse': false
        };

        // Initialize
        async function init() {
            console.log('=== BINGO INIT ===');
            console.log('Session Token:', sessionToken);
            console.log('JWT Token:', jwtToken);
            console.log('Is Demo:', isDemo);

            createNumbersBoard();
            generateCards();

            if (isDemo) {
                console.log('Starting in DEMO mode');
                balance = 1000;
                updateDisplay();
                return;
            }

            if (!sessionToken) {
                console.error('NO SESSION TOKEN!');
                alert('Session token is missing! Please start the game from the casino lobby.');
                return;
            }

            console.log('Starting in REAL MONEY mode');
            await fetchBalance();
            updateDisplay();
        }

        async function fetchBalance() {
            const BACKEND_URL = 'http://localhost:8080';
            try {
                const balanceUrl = `${BACKEND_URL}/api/user/balance?sessionToken=${sessionToken}`;
                console.log('Fetching balance from:', balanceUrl);

                const response = await fetch(balanceUrl);
                console.log('Balance response status:', response.status);

                if (response.ok) {
                    const data = await response.json();
                    console.log('Balance data:', data);
                    balance = parseFloat(data.balance);

                    const gameInfoUrl = `${BACKEND_URL}/api/user/game-info?sessionToken=${sessionToken}`;
                    const gameInfoResponse = await fetch(gameInfoUrl);
                    if (gameInfoResponse.ok) {
                        const gameData = await gameInfoResponse.json();
                        gameId = gameData.gameId;
                        console.log('Game info:', gameData);
                    }
                } else {
                    console.error('Failed to fetch balance, status:', response.status);
                    balance = 1000;
                }
            } catch (error) {
                console.error('Error fetching balance:', error);
                balance = 1000;
            }
        }

        function createNumbersBoard() {
            for (let i = 1; i <= 90; i++) {
                const ball = document.createElement('div');
                ball.className = 'number-ball';
                ball.textContent = i;
                ball.id = `ball-${i}`;
                numbersGridEl.appendChild(ball);
            }
        }

        function generateCards() {
            cards = [];
            cardsGridEl.innerHTML = '';

            for (let c = 0; c < 6; c++) {
                const card = generateBingoCard(c + 1);
                cards.push(card);
                renderCard(card);
            }
        }

        function generateBingoCard(cardNum) {
            const card = {
                id: cardNum,
                numbers: [],
                daubed: new Set(),
                wins: []
            };

            // Generate 3 rows x 9 columns = 27 cells, 15 numbers, 12 empty
            for (let row = 0; row < 3; row++) {
                const rowNumbers = [];
                const columnsUsed = new Set();

                // Each row has exactly 5 numbers
                while (columnsUsed.size < 5) {
                    const col = Math.floor(Math.random() * 9);
                    if (!columnsUsed.has(col)) {
                        columnsUsed.add(col);
                    }
                }

                for (let col = 0; col < 9; col++) {
                    if (columnsUsed.has(col)) {
                        // Generate number for this column
                        const min = col === 0 ? 1 : col * 10;
                        const max = col === 0 ? 9 : col === 8 ? 90 : (col + 1) * 10 - 1;

                        let num;
                        do {
                            num = Math.floor(Math.random() * (max - min + 1)) + min;
                        } while (card.numbers.flat().includes(num));

                        rowNumbers.push(num);
                    } else {
                        rowNumbers.push(null);
                    }
                }
                card.numbers.push(rowNumbers);
            }

            return card;
        }

        function renderCard(card) {
            const cardEl = document.createElement('div');
            cardEl.className = 'bingo-card';
            cardEl.innerHTML = `<div class="card-header">Card ${card.id}</div>`;

            const gridEl = document.createElement('div');
            gridEl.className = 'card-grid';

            for (let row = 0; row < 3; row++) {
                for (let col = 0; col < 9; col++) {
                    const cell = document.createElement('div');
                    const num = card.numbers[row][col];

                    if (num === null) {
                        cell.className = 'card-cell empty';
                    } else {
                        cell.className = 'card-cell';
                        cell.textContent = num;
                        cell.dataset.cardId = card.id;
                        cell.dataset.number = num;
                        cell.addEventListener('click', () => manualDaub(card.id, num));
                    }

                    gridEl.appendChild(cell);
                }
            }

            cardEl.appendChild(gridEl);

            const winsEl = document.createElement('div');
            winsEl.id = `wins-${card.id}`;
            cardEl.appendChild(winsEl);

            cardsGridEl.appendChild(cardEl);
        }

        function manualDaub(cardId, number) {
            if (!calledNumbers.includes(number)) return;

            const card = cards.find(c => c.id === cardId);
            if (card.daubed.has(number)) {
                card.daubed.delete(number);
            } else {
                card.daubed.add(number);
            }
            updateCardDisplay(card);
            checkWins(card);
        }

        function updateCardDisplay(card) {
            const cells = document.querySelectorAll(`[data-card-id="${card.id}"]`);
            cells.forEach(cell => {
                const num = parseInt(cell.dataset.number);
                if (card.daubed.has(num)) {
                    cell.classList.add('daubed');
                } else {
                    cell.classList.remove('daubed');
                }
            });
        }

        function checkWins(card) {
            const winsEl = document.getElementById(`wins-${card.id}`);
            winsEl.innerHTML = '';

            // Check each row for full line
            let linesCompleted = 0;
            for (let row = 0; row < 3; row++) {
                const rowNumbers = card.numbers[row].filter(n => n !== null);
                const allDaubed = rowNumbers.every(n => card.daubed.has(n));
                if (allDaubed) {
                    linesCompleted++;
                }
            }

            // Check full house (all numbers daubed)
            const allNumbers = card.numbers.flat().filter(n => n !== null);
            const isFullHouse = allNumbers.every(n => card.daubed.has(n));

            // Award prizes
            if (isFullHouse && !winsClaimed.fullhouse) {
                winsEl.innerHTML = '<div class="win-indicator">FULL HOUSE! üéâ</div>';
                claimWin('fullhouse');
            } else if (linesCompleted >= 2 && !winsClaimed['2lines']) {
                winsEl.innerHTML = '<div class="win-indicator">2 LINES! ‚ú®</div>';
                claimWin('2lines');
            } else if (linesCompleted >= 1 && !winsClaimed['1line']) {
                winsEl.innerHTML = '<div class="win-indicator">1 LINE! ‚≠ê</div>';
                claimWin('1line');
            }
        }

        function claimWin(type) {
            if (winsClaimed[type]) return;

            winsClaimed[type] = true;
            const prize = prizes[type];
            balance += prize;
            updateDisplay();

            const messages = {
                '1line': `üéâ ONE LINE COMPLETE! You won $${prize}!`,
                '2lines': `‚ú® TWO LINES COMPLETE! You won $${prize}!`,
                'fullhouse': `üèÜ FULL HOUSE! You won $${prize}!`
            };

            showMessage(messages[type], 'win');

            if (type === 'fullhouse') {
                setTimeout(() => endGame(), 3000);
            }
        }

        // Chip selection
        document.querySelectorAll('.chip').forEach(chip => {
            chip.addEventListener('click', () => {
                document.querySelectorAll('.chip').forEach(c => c.classList.remove('selected'));
                chip.classList.add('selected');
                cardPrice = parseInt(chip.dataset.value);
                updateDisplay();
            });
        });

        startBtn.addEventListener('click', async () => {
            if (isPlaying) return;

            const totalCost = cardPrice;
            if (balance < totalCost) {
                showMessage('Insufficient balance!', 'lose');
                return;
            }

            balance -= totalCost;
            updateDisplay();

            if (!isDemo && sessionToken) {
                await updateServerBalance(totalCost, 0);
            }

            startGame();
        });

        function startGame() {
            isPlaying = true;
            calledNumbers = [];
            remainingNumbers = Array.from({length: 90}, (_, i) => i + 1);
            winsClaimed = { '1line': false, '2lines': false, 'fullhouse': false };

            // Reset all cards
            cards.forEach(card => {
                card.daubed.clear();
                updateCardDisplay(card);
                document.getElementById(`wins-${card.id}`).innerHTML = '';
            });

            // Reset numbers board
            for (let i = 1; i <= 90; i++) {
                document.getElementById(`ball-${i}`).classList.remove('called');
            }

            startBtn.disabled = true;
            newCardsBtn.disabled = true;
            resultMessageEl.textContent = '';
            ballsCalledEl.textContent = '0';

            callNumbers();
        }

        function callNumbers() {
            gameInterval = setInterval(() => {
                if (remainingNumbers.length === 0 || winsClaimed.fullhouse) {
                    endGame();
                    return;
                }

                const randomIndex = Math.floor(Math.random() * remainingNumbers.length);
                const number = remainingNumbers.splice(randomIndex, 1)[0];
                calledNumbers.push(number);

                ballNumberEl.textContent = number;
                ballTextEl.textContent = getBingoCall(number);
                ballsCalledEl.textContent = calledNumbers.length;

                document.getElementById(`ball-${number}`).classList.add('called');

                if (autoDaub) {
                    cards.forEach(card => {
                        const allNumbers = card.numbers.flat().filter(n => n !== null);
                        if (allNumbers.includes(number)) {
                            card.daubed.add(number);
                            updateCardDisplay(card);
                            checkWins(card);
                        }
                    });
                }
            }, 2000);
        }

        function getBingoCall(number) {
            const calls = {
                1: "Kelly's Eye",
                11: "Legs Eleven",
                22: "Two Little Ducks",
                88: "Two Fat Ladies",
                90: "Top of the Shop"
            };
            return calls[number] || `Number ${number}`;
        }

        function endGame() {
            clearInterval(gameInterval);
            isPlaying = false;
            startBtn.disabled = false;
            newCardsBtn.disabled = false;

            if (winsClaimed.fullhouse) {
                showMessage('üèÜ FULL HOUSE! Game complete!', 'win');
            } else {
                showMessage('Game over. Better luck next time!', 'lose');
            }
        }

        autodaubBtn.addEventListener('click', () => {
            autoDaub = !autoDaub;
            autodaubBtn.textContent = `Auto-Daub: ${autoDaub ? 'ON' : 'OFF'}`;
            autodaubBtn.classList.toggle('active');
        });

        newCardsBtn.addEventListener('click', () => {
            if (isPlaying) return;
            generateCards();
            resultMessageEl.textContent = '';
        });

        async function updateServerBalance(betAmt, winAmt) {
            if (isDemo) {
                console.log('Demo mode - not updating server balance');
                return;
            }

            const BACKEND_URL = 'http://localhost:8080';
            try {
                if (!jwtToken) {
                    console.error('No JWT token found');
                    return;
                }

                const response = await fetch(`${BACKEND_URL}/api/user/games/spin`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${jwtToken}`
                    },
                    body: JSON.stringify({
                        sessionToken: sessionToken,
                        gameId: gameId,
                        betAmount: betAmt,
                        roundId: roundId++
                    })
                });

                if (!response.ok) {
                    console.error('Spin request failed:', response.status);
                    return;
                }

                const data = await response.json();
                console.log('Spin result:', data);
                balance = data.newBalance;
                updateDisplay();
            } catch (error) {
                console.error('Error updating balance:', error);
            }
        }

        function updateDisplay() {
            balanceEl.textContent = balance.toFixed(2);
            cardPriceEl.textContent = cardPrice.toFixed(2);
        }

        function showMessage(text, type) {
            resultMessageEl.textContent = text;
            resultMessageEl.className = `result-message ${type}`;
        }

        init();
    </script>
</body>
</html>
